rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Regras para sistema médico existente
    match /doctors/{doctorId} {
      allow read, write: if request.auth != null && request.auth.uid == doctorId;
    }
    
    match /patients/{patientId} {
      allow read, write: if request.auth != null;
    }
    
    // Regras para sistema de escalas
    match /users/{userId} {
      allow read, write: if request.auth != null;
    }
    
    match /residentes/{residenteId} {
      allow read, write: if request.auth != null;
    }
    
    match /locais/{localId} {
      allow read, write: if request.auth != null;
    }
    
    match /servicos/{servicoId} {
      allow read, write: if request.auth != null;
    }
    
    match /escalas/{escalaId} {
      allow read, write: if request.auth != null;
    }
    
    // Regras para sistema de trocas
    match /trocas/{trocaId} {
      allow read, write: if request.auth != null;
    }
    
    match /notificacoes_troca/{notificacaoId} {
      allow read, write: if request.auth != null;
    }
    
    // Regras para férias
    match /ferias/{feriasId} {
      allow read, write: if request.auth != null;
    }
    
    match /notificacoes_ferias/{notificacaoId} {
      allow read, write: if request.auth != null;
    }
    
    // NOVA: Regras para notificações internas
    match /notificacoes/{notificationId} {
      allow read, write: if request.auth != null;
    }
    
    // Logs de notificações (caso ainda existam)
    match /notification_logs/{logId} {
      allow read, write: if request.auth != null;
    }
    
    // Regras para sistema de mensagens
    match /mensagens/{mensagemId} {
      allow read, write: if request.auth != null;
    }
    
    match /mensagens_residentes/{mensagemResidenteId} {
      allow read, write: if request.auth != null;
    }
    
    // Regras para pacientes_completos e subcoleções (nutricao)
    match /pacientes_completos/{pacienteId} {
      allow read, write: if request.auth != null;
      
      // Subcoleção nutricao
      match /nutricao/{document=**} {
        allow read, write: if request.auth != null;
      }
    }
    
    // Fallback para outras collections
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}