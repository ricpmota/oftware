// üìÅ calculadoraTratamentoRD.ts

/**
 * Fun√ß√£o de l√≥gica cl√≠nica para gerar conduta baseada em classifica√ß√£o da Retinopatia Diab√©tica,
 * presen√ßa de Edema Macular Diab√©tico (EMD), achados de OCT e comorbidades.
 * Ideal para uso em um modal interativo ou formul√°rio de apoio √† decis√£o cl√≠nica.
 */

export interface FormularioRD {
  classificacao: 'RDNP Leve' | 'RDNP Moderada' | 'RDNP Grave' | 'RDP' | 'RDP Alto Risco';
  emdPresente: 'ausente' | 'presente sem centro' | 'presente com centro';
  achadoOCT: 'espessamento retiniano' | 'preservado' | 'n√£o realizado';
  comorbidades: string[]; // Ex: ['HAS', 'DRC']
  gestante: boolean;
}

export function gerarCondutaRD(form: FormularioRD): string {
  const { classificacao, emdPresente, achadoOCT, comorbidades, gestante } = form;

  let conduta = '';

  // ‚öôÔ∏è Bloco Baseado na Classifica√ß√£o
  if (classificacao === 'RDNP Leve') {
    if (emdPresente === 'ausente') {
      conduta += 'Controle glic√™mico e acompanhamento em 12 meses.';
    } else if (emdPresente === 'presente com centro') {
      conduta += 'Solicitar OCT se n√£o realizado. Se confirmado, iniciar Anti-VEGF. Acompanhamento mensal.';
    } else {
      conduta += 'Solicitar OCT. Se espessamento perifoveal, considerar fotocoagula√ß√£o focal.';
    }
  }

  else if (classificacao === 'RDNP Moderada') {
    if (emdPresente === 'ausente') {
      conduta += 'Controle rigoroso glic√™mico + seguimento em 6 meses.';
    } else if (emdPresente === 'presente com centro') {
      conduta += 'Confirmar com OCT. Iniciar Anti-VEGF. Reavalia√ß√£o em 30 dias.';
    } else {
      conduta += 'Considerar fotocoagula√ß√£o focal se OCT com espessamento perifoveal. Seguimento em 3 meses.';
    }
  }

  else if (classificacao === 'RDNP Grave') {
    if (emdPresente === 'ausente') {
      conduta += 'Encaminhar para retina. Considerar PRP se risco iminente de progress√£o. Acompanhamento em 2 meses.';
    } else {
      conduta += 'Avalia√ß√£o de especialista. Anti-VEGF + considerar PRP. Acompanhamento mensal.';
    }
  }

  else if (classificacao === 'RDP') {
    conduta += 'Indica√ß√£o de PRP (fotocoagula√ß√£o panretiniana) + Anti-VEGF se EMD presente.';
  }

  else if (classificacao === 'RDP Alto Risco') {
    conduta += 'PRP urgente + Anti-VEGF. Reavalia√ß√£o a cada 15 dias. Avaliar risco de hemorragia v√≠trea.';
  }

  // ‚öôÔ∏è Ajustes por Achado de OCT
  if (achadoOCT === 'espessamento retiniano' && !conduta.includes('Anti-VEGF')) {
    conduta += ' OCT com espessamento sugere in√≠cio de Anti-VEGF imediato.';
  }

  // ‚öôÔ∏è Ajustes por Comorbidades
  if (comorbidades.includes('DRC') || comorbidades.includes('HAS')) {
    conduta += ' Monitorar press√£o e fun√ß√£o renal. A resposta ao Anti-VEGF pode ser alterada.';
  }

  if (gestante) {
    conduta += ' Evitar Anti-VEGF. Preferir observa√ß√£o ou fotocoagula√ß√£o a laser.';
  }

  return conduta;
}
